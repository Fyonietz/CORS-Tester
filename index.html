<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CORS Tester</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #1e1e1e;
      color: #ddd;
      padding: 2rem;
    }
    h1 {
      color: #61dafb;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input, select, textarea, button {
      width: 100%;
      margin-top: 0.5rem;
      padding: 0.5rem;
      border: 1px solid #444;
      border-radius: 4px;
      background: #2c2c2c;
      color: #ddd;
      font-family: monospace;
    }
    input[type="checkbox"] {
      width: auto;
      margin-right: 0.5rem;
    }
    button {
      background: #61dafb;
      color: #000;
      cursor: pointer;
      font-weight: bold;
      margin-top: 1rem;
    }
    button:hover {
      background: #4ec3e0;
    }
    pre {
      background: #111;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      font-family: monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .response-section {
      margin-top: 2rem;
    }

    /* Syntax highlighting */
    .string { color: #98c379; }
    .number { color: #d19a66; }
    .boolean { color: #56b6c2; }
    .null { color: #c678dd; }
    .key { color: #e06c75; }

    .headers-grid {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 0.5rem;
      align-items: center;
    }
    .headers-grid input {
      width: 100%;
    }
    .headers-grid button {
      width: 100%;
      background: #444;
      color: #eee;
      border: none;
    }
    .headers-grid button:hover {
      background: #666;
    }
  </style>
</head>
<body>
  <h1>CORS Tester</h1>

  <label for="url">Target URL</label>
  <input type="text" id="url" placeholder="https://example.com/api">

  <label for="method">HTTP Method</label>
  <select id="method">
    <option value="GET">GET</option>
    <option value="POST">POST</option>
  </select>

  <label for="body">JSON Body (for POST)</label>
  <textarea id="body" rows="8" placeholder='{"key": "value"}'></textarea>

  <label>
    <input type="checkbox" id="includeCreds"> Include credentials (cookies / HTTP auth)
  </label>

  <h3>Custom Headers</h3>
  <div id="headers-container" class="headers-grid">
    <input type="text" placeholder="Header name (e.g. Cookie)" class="header-key">
    <input type="text" placeholder="Header value" class="header-value">
    <button type="button" class="remove-btn">✖</button>
  </div>
  <button id="addHeaderBtn">+ Add Header</button>

  <button id="sendBtn">Send Request</button>

  <div class="response-section">
    <h2>Response</h2>
    <h3>Status:</h3>
    <pre id="status"></pre>

    <h3>Headers:</h3>
    <pre id="headers"></pre>

    <h3>Body:</h3>
    <pre id="response"></pre>
  </div>

  <script>
    // Syntax highlighting
    function syntaxHighlight(json) {
      if (typeof json != 'string') json = JSON.stringify(json, undefined, 2);
      json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, match => {
        let cls = 'number';
        if (/^"/.test(match)) {
          if (/:$/.test(match)) cls = 'key';
          else cls = 'string';
        } else if (/true|false/.test(match)) cls = 'boolean';
        else if (/null/.test(match)) cls = 'null';
        return `<span class="${cls}">${match}</span>`;
      });
    }

    // Add/remove header rows
    const headersContainer = document.getElementById('headers-container');
    document.getElementById('addHeaderBtn').addEventListener('click', () => {
      const div = document.createElement('div');
      div.className = 'headers-grid';
      div.innerHTML = `
        <input type="text" placeholder="Header name" class="header-key">
        <input type="text" placeholder="Header value" class="header-value">
        <button type="button" class="remove-btn">✖</button>
      `;
      headersContainer.parentNode.insertBefore(div, document.getElementById('addHeaderBtn'));
      div.querySelector('.remove-btn').addEventListener('click', () => div.remove());
    });
    document.querySelector('.remove-btn').addEventListener('click', (e) => e.target.parentNode.remove());

    // Send request
    document.getElementById('sendBtn').addEventListener('click', async () => {
      const url = document.getElementById('url').value.trim();
      const method = document.getElementById('method').value;
      const bodyText = document.getElementById('body').value.trim();
      const includeCreds = document.getElementById('includeCreds').checked;

      if (!url) {
        alert("Please enter a URL!");
        return;
      }

      const options = {
        method,
        headers: {},
        credentials: includeCreds ? "include" : "omit"
      };

      // Collect custom headers
      document.querySelectorAll('.headers-grid').forEach(grid => {
        const key = grid.querySelector('.header-key')?.value.trim();
        const val = grid.querySelector('.header-value')?.value.trim();
        if (key) options.headers[key] = val;
      });

      // Default Content-Type if POST
      if (method === "POST" && !options.headers["Content-Type"])
        options.headers["Content-Type"] = "application/json";

      if (method === "POST" && bodyText) {
        try {
          options.body = JSON.stringify(JSON.parse(bodyText));
        } catch {
          alert("Invalid JSON!");
          return;
        }
      }

      document.getElementById('status').textContent = "Loading...";
      document.getElementById('headers').textContent = "";
      document.getElementById('response').innerHTML = "";

      try {
        const res = await fetch(url, options);
        const resText = await res.text();

        document.getElementById('status').textContent = `${res.status} ${res.statusText}`;
        let headers = "";
        res.headers.forEach((v, k) => headers += `${k}: ${v}\n`);
        document.getElementById('headers').textContent = headers;

        try {
          const json = JSON.parse(resText);
          document.getElementById('response').innerHTML = syntaxHighlight(json);
        } catch {
          document.getElementById('response').textContent = resText;
        }
      } catch (err) {
        document.getElementById('status').textContent = "Request Failed";
        document.getElementById('response').textContent = err.toString();
      }
    });
  </script>
</body>
</html>


